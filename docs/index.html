<!DOCTYPE html>
<head>
	<meta name="viewport" content="width=750,user-scalable=yes">
	<meta name="format-detection" content="telephone=no">
	<meta name="SKYPE_TOOLBAR" content="SKYPE_TOOLBAR_PARSER_COMPATIBLE">
	<meta property="og:audio" content="">	
	<meta property="og:site_name"   content="虎子のサウンドボタン">	
	<meta property="og:url"         content="index.html">
	<meta property="og:title"       content="虎子ボタン">
	<meta property="og:description" content="虎子ちゃんが喋ってくれるよ">	
	<meta property="og:image"       content="https://windwalker429.github.io/torako/icon.png">
	<meta property="og:image:secure_url"       content="https://windwalker429.github.io/torako/icon.png">
	<meta property="og:image:type" content="image/png" /> 
	<meta property="og:image:width"  content="800">
	<meta property="og:image:height" content="400">
	<link rel="shortcut icon" href="favicon.ico">
</head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R2YYPGFHSR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R2YYPGFHSR');
</script>


<html lang="ja">
	<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# undefined: http://ogp.me/ns/undefined#">
		<title>こんとら〜</title>
		<link rel="stylesheet" href="./css/style.css?v=201903-01">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
	</head>
	<body id="g">
		<script>
			var isPC = true;
			(function () { if (navigator.userAgent.toLowerCase().match(/iphone|ipad|android/)) { document.body.classList.add('sp');isPC=false;return; } document.body.classList .add('pc'); })();
		</script>
		<!--block body-->    
		<div id="wrapper">
			<main class="mainContent">
				<h1>こんとら〜</h1>
				<p class="desc_top"><a href="https://www.youtube.com/@YahooTWTORAKOHO" target="_blank">虎子ちゃん</a>が喋ってくれるよ。<br>音量には注意してね。</p>
				<div class="singleButtonWrapper">
					<div class="button_wrapper" id="singleButtonWrapper"></div>
					<div class="content">
						<p><a id="audio_link" href="#">Download</a></p>
						<p><a href="/torako/">一覧に戻る</a></p>
					</div>
				</div>
				<div class="tab_css">
					<input id="tabA" type="radio" name="tab" checked="checked" onclick="checkSearchBar()"></input>
					<label for="tabA">總覽</label>
					<div class="tab_content">
						<div class="search">
							<span class="searchbar-icon"><i class="fas fa-search"></i></span>
							<input type="text" id="searchBar" onkeyup="searchByKeywords()" placeholder="">
						</div>
						<div class="multiButtonWrapper">
							<div id="banners"></div>
						</div>	
					</div>
					<input id="tabB" type="radio" name="tab" onclick="checkSearchBar()"/>
					<label for="tabB">分類</label>
					<div class="tab_content">						
						<div class="tab_css" id="subtabs">							
						</div>
					</div>
				</div>	
				<div class="infoWrapper" id="infoWrapper">
					<p><a href="#" target="_blank" id="fixedLink">このボタンへのリンク</a></p>
				</div>
			</main>
			<!--<button class="button-play">Button 1</button>
			<button class="button-play">Button 2</button>
			<button class="button-play">Button 3</button>-->
			<div class="mainFooter">
				<div class="credit">
					
					<p>聲音的所有權屬於原始創作者。音声等の権利は、全て元権利者に帰属します。</p>
					<p>聲音以外的部分遵守<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja" target="_blank">CC-BY-NC-SA-4.0</a>授權。音声以外の部分については、<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja" target="_blank">CC-BY-NC-SA-4.0</a>に基づき自由にご利用ください。 </p>
					<!--<p>原ソースコードは<a href="https://github.com/niltea/hanarisa-button" target="_blank">こちら</a>。</p>-->
					<p>長期招募協作者:歡迎熟悉「git版控系統」與「Audio剪輯」的大福們加入剪輯行列。</p>
					<p>本頁面原始程式碼請<a href="https://github.com/windwalker429/torako" target="_blank">按這邊</a>。</p>

					<p>協作者: windwalker / 梅子餅 / 風零寂雨 / Hikari Tsai / 不合時宜</p>
				</div>
			</div>
		</div>
	</body>	
	<style>
		.tab_css{display:flex;flex-wrap:wrap;justify-content:center;}
		.tab_css input{display:none}
		.tab_css label{margin: 0 5px 5px 0; padding: 10px 16px; cursor: pointer; border-radius: 5px; background: #999; color: #fff; opacity: 0.5;}
		.tab_content{order:1;display: none; width:100%; border-bottom: 3px solid #ddd; line-height: 1.6; font-size: .9em; padding: 15px; border: 1px solid #ddd; border-radius: 5px;}
		.tab_css input:checked + label, .tab_css label:hover{opacity: 1; font-weight:bold;}
		.tab_css input:checked + label + .tab_content{display: initial;}
	</style>
	<!--<input type="file" id="file-selector" multiple>-->
	<script>
		function checkSearchBar() {
			var tabB = document.getElementById('tabB');
			var searchDiv = document.getElementsByClassName("search")[0];
			if (tabB.checked) {
				searchDiv.children[1].value = '';
				showAllButtons();
			}
		}
		
		function searchByKeywords() {
			var input = document.getElementById('searchBar');
			var inputUpper = input.value.toUpperCase();
			var streams = document.querySelectorAll(".movie_wrapper");
			if ( input.value == "" ) {
				showAllButtons()
			}
			else{
				streams.forEach( stream => {
				items = stream.querySelectorAll(".button-play");
				var isBlockHide = true;
				var itemCount = 0;
				items.forEach( item => {
					var txtValue = item.innerText;
					if (txtValue.toUpperCase().indexOf(inputUpper) > -1) {
						if (window.screen.width>=1300) {
							if ( itemCount % 3 == 0) { 
							item.style.marginLeft = "0";
							}
							else {
								item.style.marginLeft = "2%";							
							}
						}						
						item.style.display = "";
						isBlockHide = false;
						itemCount++;
					} 
					else {
						item.style.display = "none";
					}
				})
				if (isBlockHide) {
					stream.style.display = "none";
				}
				else
					stream.style.display = "";
				})
			}
		}
		
		function showAllButtons() {
			var streams = document.querySelectorAll(".movie_wrapper");
			streams.forEach ( stream => {
				stream.style.display = "";
			})
			
			var items = document.querySelectorAll(".button-play");
			items.forEach ( item => {
				item.style.marginLeft = "";
				item.style.display = "";
			})
		}

		function readTextFile(file,callback) {
		var rawFile = new XMLHttpRequest();
		rawFile.overrideMimeType("application/json");
		rawFile.open("GET", file, true);
		rawFile.onreadystatechange = function() {
			if (rawFile.readyState === 4 && rawFile.status == "200") {
				callback(rawFile.responseText);
			}
		}
		rawFile.send(null);
		}
		
		readTextFile("https://windwalker429.github.io/torako/buttons.json" , function(text){
			var jsonobj = JSON.parse(text);
			
			var subtabs = document.getElementById("subtabs");
			var tabs = jsonobj.tablist;
			for(var count=0 ; count<tabs.length ; count++){
				var input = document.createElement("input");	
				var tabId = "tab"+count;
				input.setAttribute("id" , tabId);
				input.setAttribute("type" , "radio");
				input.setAttribute("name" , "subtab");
				subtabs.appendChild(input);
				
				var tabTitle = tabs[count].title;
				var tag = tabs[count].tag;
								
				var label = document.createElement("label");
				label.setAttribute("for" , tabId);
				label.innerHTML = tabTitle;
				subtabs.appendChild(label);
								
				var div = document.createElement("div");
				div.setAttribute("class" , "tab_content");
				var subdiv = document.createElement("div");
				subdiv.setAttribute("class" , "button_wrapper");
				subdiv.setAttribute("id" , tag);
				div.appendChild(subdiv);
				subtabs.appendChild(div);
			}
						
			var banners = document.getElementById("banners");
			var obj = jsonobj.fulllist;
			for(var i=0 ; i<obj.length ; i++){			
				var div = document.createElement("div");
				div.className = "movie_wrapper";						
				div.innerHTML='<h2 class="movie_title"><a href="' + obj[i].url +'" target="_blank">' + obj[i].name + '</a></h2>';
				var childdiv = document.createElement("div");
				childdiv.className="button_wrapper";
				for(var j=0 ; j<obj[i].context.length ; j++){
					var btndiv = document.createElement("div");
					btndiv.className = "button button-play";						
					btndiv.setAttribute("data-voice" ,obj[i].context[j].filename);				
					btndiv.innerHTML=obj[i].context[j].name;
					childdiv.appendChild(btndiv);
					btndiv.addEventListener('click', trackButtonClick); //Hikari Add
					
					if(obj[i].context[j].tag){
						for(var k=0 ; k<obj[i].context[j].tag.length ; k++){
							if(obj[i].context[j].tag[k]){
								var btndivC = document.createElement("div");
								btndivC.className = "button button-play";						
								btndivC.setAttribute("data-voice" ,obj[i].context[j].filename);				
								btndivC.innerHTML=obj[i].context[j].name;
								var catelog = document.getElementById(obj[i].context[j].tag[k]);
								if(catelog){
									catelog.appendChild(btndivC);
								}								
							}
						}												
					}					
				}
			div.appendChild(childdiv);
			banners.appendChild(div);
		}
		window.document.dispatchEvent(new Event("DOMContentLoadedConfirm", {
			bubbles: true,
			cancelable: true
			}));
		});					
	</script>
	<script src="./js/app.js"></script>
	<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
	<script>
		// 定義追踪事件的函數
		function trackButtonClick(event) {
		  // 獲取被點擊按鈕的文本或其他變數
		  var buttonText = event.target.innerText;
	  
		  // 發送事件到Google Analytics
		  gtag('event', 'button_click', {
			'event_category': 'Button',
			'event_label': buttonText
		  });
		  console.log("button trigger: "+ buttonText); // Hikari for testing
		}
	</script>
	  
</html>
